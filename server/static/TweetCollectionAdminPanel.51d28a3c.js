import{r as u}from"./react.4f0cd3ad.js";import{T as S,t as w,n as M,P as v,C as R,p as O}from"./index.c2b73278.js";import{a as p,j as t,T as x,B as y,F as C,S as D,A as F,g as H,M as N,h as P,i as m,k as I,l as B,P as j,m as L,n as U,o as W}from"./mui.5c906c20.js";import"./chart_js.24276de0.js";const z=({offset:e,setOffset:r,toggleReload:n})=>{const[s,a]=u.exports.useState(e);return p("div",{className:"w-5/12 flex items-end mb-3",children:[t(x,{label:"Offset",value:s,type:"number",onChange:({target:{value:o}})=>a(parseInt(o)),onKeyDown:({key:o})=>{o==="Enter"&&r(s)}}),t(y,{onClick:n,children:"Refuel"})]})};var h=(e=>(e[e.NewPhrase=0]="NewPhrase",e[e.ChangeStart=1]="ChangeStart",e[e.ChangeEnd=2]="ChangeEnd",e[e.ChangeAspect=3]="ChangeAspect",e[e.DeletePhrase=4]="DeletePhrase",e[e.Verify=5]="Verify",e[e.ChangeSentenceAnnotaion=6]="ChangeSentenceAnnotaion",e))(h||{});const K=["others","profanity","physical_threat","rape_threat","ethnic_racism","religion_racism","sexism"],_={start:0,startHelperText:"Start Offset (inclusive)",end:0,endHelperText:"End Offset (exclusive)",hasErrorOccurred:!1,aspect:0},T=(e,r,n)=>{const s=r>=n;let{startHelperText:a,endHelperText:o}=_;return s&&(a=o="start must be less than end"),{...e,start:r,end:n,hasErrorOccurred:s,startHelperText:a,endHelperText:o}},q=(e,r)=>{switch(r.type){case 0:return{...e,aspects_anno:[...e.aspects_anno,_]};case 1:{const{index:n,start:s}=r.payload,a=[...e.aspects_anno],o=a[n],c=T(o,s,o.end);return a[n]=c,{...e,aspects_anno:a}}case 2:{const{index:n,end:s}=r.payload,a=[...e.aspects_anno],o=a[n],c=T(o,o.start,s);return a[n]=c,{...e,aspects_anno:a}}case 3:{const{index:n,aspect:s}=r.payload,a=[...e.aspects_anno],o=a[n];return a[n]={...o,aspect:s},{...e,aspects_anno:a}}case 4:{const{index:n}=r.payload,s=[...e.aspects_anno];return s.splice(n,1),{...e,aspects_anno:s}}case 5:return{...e,isVerified:!0};case 6:return{...e,[r.payload.column]:r.payload.value};default:return e}},G=({tweetId:e,getChangedColumns:r,disabled:n})=>{const[s,a]=u.exports.useState({display:!1,message:"",intent:"success"}),o=()=>a(f=>({...f,display:!1})),c=async()=>{try{return await S.tweetsUpdateTweet(e,r()),a({display:!0,message:"Successfully Modified",intent:"success"})}catch{return a({display:!1,message:"Modification Failed",intent:"error"})}};return p(C,{children:[t(D,{open:s.display,autoHideDuration:3e3,onClose:o,children:t(F,{onClose:o,severity:s.intent,sx:{width:"100%"},children:s.message})}),t(y,{variant:"contained",onClick:c,disabled:n,children:"Modify"})]})},J=({aspects_anno:e,dispatch:r,isDisabled:n})=>p(C,{children:[e.map(({start:s,hasErrorOccurred:a,startHelperText:o,end:c,endHelperText:f,aspect:d},l)=>p("div",{children:[t(x,{inputProps:{inputMode:"numeric",step:1},value:s,error:a,onChange:({target:{value:i}})=>r({type:h.ChangeStart,payload:{index:l,start:parseInt(i)}}),helperText:o}),t(x,{inputProps:{inputMode:"numeric",step:1},value:c,error:a,onChange:({target:{value:i}})=>r({type:h.ChangeEnd,payload:{index:l,end:parseInt(i)}}),helperText:f}),t(H,{value:d,label:"Aspect",onChange:({target:{value:i}})=>r({type:h.ChangeAspect,payload:{index:l,aspect:i}}),children:K.map(w).map((i,g)=>t(N,{value:g,children:i},g))}),t(y,{variant:"contained",color:"warning",onClick:()=>r({type:h.DeletePhrase,payload:{index:l}}),disabled:n,children:"Delete Annotation"})]},l)),t(y,{variant:"contained",color:"secondary",onClick:()=>r({type:h.NewPhrase}),disabled:n,children:"Add New Phrase Annotation"})]}),b=([e,r,n],[s,a,o])=>e-s||r-a||n-o,Q=({row:e,action:r})=>{var d;const[n,s]=u.exports.useReducer(q,{...e,isVerified:!1,aspects_anno:((d=e.aspects_anno)==null?void 0:d.map(([l,i,g])=>({..._,start:l,end:i,aspect:g})))||[]}),a=(l,i)=>s({type:h.ChangeSentenceAnnotaion,payload:{value:l,column:i}}),o=()=>{const l={};e.is_abuse!==n.is_abuse&&(l.is_abuse=n.is_abuse),e.sexual_score!==n.sexual_score&&(l.sexual_score=n.sexual_score);const i=n.aspects_anno.map(({start:A,end:k,aspect:V})=>[A,k,V]).sort(b),g=[...e.aspects_anno||[]].sort(b);return M(i,g)||(l.aspects_anno=i),l},c=u.exports.useMemo(()=>n.aspects_anno.every(({hasErrorOccurred:l})=>!l),[n.aspects_anno]),f=()=>{c?v.pseudoTweetsVerifyPseudoTweet(e.id,o()).then(()=>s({type:h.Verify})):console.error("Error in phrase annotaion")};return p(P,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[p(m,{sx:{fontSize:"1rem",paddingTop:"0px"},align:"left",children:[t("p",{className:"mb-1.5",children:e.text}),t(J,{aspects_anno:n.aspects_anno,dispatch:s,isDisabled:r==="verify"&&n.isVerified})]}),t(m,{align:"center",children:t(I,{checked:n.is_abuse,onChange:({target:{checked:l}})=>{a(l,"is_abuse")}})}),t(m,{align:"center",children:t(x,{inputProps:{inputMode:"numeric",pattern:"[1-9]|10"},value:n.sexual_score,onChange:({target:{value:l}})=>{a(parseInt(l),"sexual_score")},helperText:"1-10"})}),t(m,{align:"right",children:r==="modify"?t(G,{tweetId:e.id,getChangedColumns:o,disabled:!c}):t(C,{children:n.isVerified?t(y,{color:"success",disabled:r==="verify"||!c,onClick:f,children:"Verified"}):t(y,{variant:"contained",onClick:f,disabled:!c,children:"Verify"})})})]},e.id)},E=({action:e})=>{const[r,n]=u.exports.useState([]),[s,a]=u.exports.useState(0),[o,c]=u.exports.useState(!1);return u.exports.useEffect(()=>{const l=(e==="verify"?v.pseudoTweetsReadPseudoTweets:S.tweetsReadTweets)(s,10);return l.then(i=>n(i)).catch(i=>{i instanceof R&&console.log("TweetCollectionAdminPanel umounted")}),()=>{l==null||l.cancel()}},[s,o]),p("div",{className:"mt-10 w-11/12 mx-auto ",children:[t(z,{offset:s,setOffset:a,toggleReload:()=>c(!o)}),t(B,{component:j,sx:{height:500},children:p(L,{stickyHeader:!0,sx:{minWidth:650,borderSpacing:"0 20px"},"aria-label":"simple table",children:[p("colgroup",{children:[t("col",{width:"70%"}),t("col",{width:"10%"}),t("col",{width:"10%"}),t("col",{width:"10%"})]}),t(U,{children:t(P,{children:["Text",...O.map(({field:d})=>d)].map(w).map((d,l)=>t(m,{align:"center",sx:{width:50,fontWeight:"bold"},children:d},l))})}),t(W,{children:r.map(d=>t(Q,{row:d,action:e},d.id))})]})})]})};export{E as default};
