import{r as u}from"./react.6fe56dd3.js";import{a as T,P as w,C as R}from"./client.d287e005.js";import{t as v,n as M,p as N}from"./index.4a3c24f8.js";import{a as p,j as t,F as C}from"./router.d69af7fb.js";import{N as x,q as m,S as O,Q as D,R as F,U as H,V as P,W as y,X as I,Y as j,r as B,Z as U,$ as W,a0 as L}from"./mui_material.b7c2c9a9.js";import"./mui_extras.818b3c37.js";import"./chart_js.84fe37ea.js";import"./chart_js_extras.3698eadf.js";const q=({offset:e,setOffset:r,toggleReload:n})=>{const[s,a]=u.exports.useState(e);return p("div",{className:"w-5/12 flex items-end mb-3",children:[t(x,{label:"Offset",value:s,type:"number",onChange:({target:{value:o}})=>a(parseInt(o)),onKeyDown:({key:o})=>{o==="Enter"&&r(s)}}),t(m,{onClick:n,children:"Refuel"})]})};var h=(e=>(e[e.NewPhrase=0]="NewPhrase",e[e.ChangeStart=1]="ChangeStart",e[e.ChangeEnd=2]="ChangeEnd",e[e.ChangeAspect=3]="ChangeAspect",e[e.DeletePhrase=4]="DeletePhrase",e[e.Verify=5]="Verify",e[e.ChangeSentenceAnnotaion=6]="ChangeSentenceAnnotaion",e))(h||{});const z=["others","profanity","physical_threat","rape_threat","ethnic_racism","religion_racism","sexism"],_={start:0,startHelperText:"Start Offset (inclusive)",end:0,endHelperText:"End Offset (exclusive)",hasErrorOccurred:!1,aspect:0},b=(e,r,n)=>{const s=r>=n;let{startHelperText:a,endHelperText:o}=_;return s&&(a=o="start must be less than end"),{...e,start:r,end:n,hasErrorOccurred:s,startHelperText:a,endHelperText:o}},K=(e,r)=>{switch(r.type){case 0:return{...e,aspects_anno:[...e.aspects_anno,_]};case 1:{const{index:n,start:s}=r.payload,a=[...e.aspects_anno],o=a[n],c=b(o,s,o.end);return a[n]=c,{...e,aspects_anno:a}}case 2:{const{index:n,end:s}=r.payload,a=[...e.aspects_anno],o=a[n],c=b(o,o.start,s);return a[n]=c,{...e,aspects_anno:a}}case 3:{const{index:n,aspect:s}=r.payload,a=[...e.aspects_anno],o=a[n];return a[n]={...o,aspect:s},{...e,aspects_anno:a}}case 4:{const{index:n}=r.payload,s=[...e.aspects_anno];return s.splice(n,1),{...e,aspects_anno:s}}case 5:return{...e,isVerified:!0};case 6:return{...e,[r.payload.column]:r.payload.value};default:return e}},Q=({tweetId:e,getChangedColumns:r,disabled:n})=>{const[s,a]=u.exports.useState({display:!1,message:"",intent:"success"}),o=()=>a(f=>({...f,display:!1})),c=async()=>{try{return await T.tweetsUpdateTweet(e,r()),a({display:!0,message:"Successfully Modified",intent:"success"})}catch{return a({display:!1,message:"Modification Failed",intent:"error"})}};return p(C,{children:[t(O,{open:s.display,autoHideDuration:3e3,onClose:o,children:t(D,{onClose:o,severity:s.intent,sx:{width:"100%"},children:s.message})}),t(m,{variant:"contained",onClick:c,disabled:n,children:"Modify"})]})},X=({aspects_anno:e,dispatch:r,isDisabled:n})=>p(C,{children:[e.map(({start:s,hasErrorOccurred:a,startHelperText:o,end:c,endHelperText:f,aspect:d},i)=>p("div",{children:[t(x,{inputProps:{inputMode:"numeric",step:1},value:s,error:a,onChange:({target:{value:l}})=>r({type:h.ChangeStart,payload:{index:i,start:parseInt(l)}}),helperText:o}),t(x,{inputProps:{inputMode:"numeric",step:1},value:c,error:a,onChange:({target:{value:l}})=>r({type:h.ChangeEnd,payload:{index:i,end:parseInt(l)}}),helperText:f}),t(F,{value:d,label:"Aspect",onChange:({target:{value:l}})=>r({type:h.ChangeAspect,payload:{index:i,aspect:l}}),children:z.map(v).map((l,g)=>t(H,{value:g,children:l},g))}),t(m,{variant:"contained",color:"warning",onClick:()=>r({type:h.DeletePhrase,payload:{index:i}}),disabled:n,children:"Delete Annotation"})]},i)),t(m,{variant:"contained",color:"secondary",onClick:()=>r({type:h.NewPhrase}),disabled:n,children:"Add New Phrase Annotation"})]}),S=([e,r,n],[s,a,o])=>e-s||r-a||n-o,Y=({row:e,action:r})=>{var d;const[n,s]=u.exports.useReducer(K,{...e,isVerified:!1,aspects_anno:((d=e.aspects_anno)==null?void 0:d.map(([i,l,g])=>({..._,start:i,end:l,aspect:g})))||[]}),a=(i,l)=>s({type:h.ChangeSentenceAnnotaion,payload:{value:i,column:l}}),o=()=>{const i={};e.is_abuse!==n.is_abuse&&(i.is_abuse=n.is_abuse),e.sexual_score!==n.sexual_score&&(i.sexual_score=n.sexual_score);const l=n.aspects_anno.map(({start:A,end:k,aspect:V})=>[A,k,V]).sort(S),g=[...e.aspects_anno||[]].sort(S);return M(l,g)||(i.aspects_anno=l),i},c=u.exports.useMemo(()=>n.aspects_anno.every(({hasErrorOccurred:i})=>!i),[n.aspects_anno]),f=()=>{c?w.pseudoTweetsVerifyPseudoTweet(e.id,o()).then(()=>s({type:h.Verify})):console.error("Error in phrase annotaion")};return p(P,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[p(y,{sx:{fontSize:"1rem",paddingTop:"0px"},align:"left",children:[t("p",{className:"mb-1.5",children:e.text}),t(X,{aspects_anno:n.aspects_anno,dispatch:s,isDisabled:r==="verify"&&n.isVerified})]}),t(y,{align:"center",children:t(I,{checked:n.is_abuse,onChange:({target:{checked:i}})=>{a(i,"is_abuse")}})}),t(y,{align:"center",children:t(x,{inputProps:{inputMode:"numeric",pattern:"[1-9]|10"},value:n.sexual_score,onChange:({target:{value:i}})=>{a(parseInt(i),"sexual_score")},helperText:"1-10"})}),t(y,{align:"right",children:r==="modify"?t(Q,{tweetId:e.id,getChangedColumns:o,disabled:!c}):t(C,{children:n.isVerified?t(m,{color:"success",disabled:r==="verify"||!c,onClick:f,children:"Verified"}):t(m,{variant:"contained",onClick:f,disabled:!c,children:"Verify"})})})]},e.id)},se=({action:e})=>{const[r,n]=u.exports.useState([]),[s,a]=u.exports.useState(0),[o,c]=u.exports.useState(!1);return u.exports.useEffect(()=>{const i=(e==="verify"?w.pseudoTweetsReadPseudoTweets:T.tweetsReadTweets)(s,10);return i.then(l=>n(l)).catch(l=>{l instanceof R&&console.log("TweetCollectionAdminPanel umounted")}),()=>{i==null||i.cancel()}},[s,o]),p("div",{className:"mt-10 w-11/12 mx-auto ",children:[t(q,{offset:s,setOffset:a,toggleReload:()=>c(!o)}),t(j,{component:B,sx:{height:500},children:p(U,{stickyHeader:!0,sx:{minWidth:650,borderSpacing:"0 20px"},"aria-label":"simple table",children:[p("colgroup",{children:[t("col",{width:"70%"}),t("col",{width:"10%"}),t("col",{width:"10%"}),t("col",{width:"10%"})]}),t(W,{children:t(P,{children:["Text",...N.map(({field:d})=>d)].map(v).map((d,i)=>t(y,{align:"center",sx:{width:50,fontWeight:"bold"},children:d},i))})}),t(L,{children:r.map(d=>t(Y,{row:d,action:e},d.id))})]})})]})};export{se as default};
