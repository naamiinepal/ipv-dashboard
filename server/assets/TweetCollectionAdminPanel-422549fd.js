import{o as u,j as s,O as T,t as b,M as k,$ as I,a0 as R,S as H,U as j,a1 as N,a2 as C,V as F,a3 as B,v as L,a4 as U,a5 as W,a6 as z}from"./mui_material-2b59c782.js";import{r as h}from"./react-75fa6e8e.js";import{C as K,T as M,A as $,t as O,l as q,n as G,P as D,u as J,a as P,b as Q,c as X,s as Y}from"./index-98216a9b.js";import"./react_router-41a0819f.js";import"./chart_js-06c18883.js";import"./chart_js_extras-fa8481ca.js";import"./moment-a2dc6acb.js";import"./mui_extras-a7940535.js";import"./word_cloud-dc361cfb.js";const Z=({offset:e,setOffset:r,toggleReload:t,combinedProps:a})=>{const[n,l]=h.exports.useState(e);return u("div",{className:"flex justify-between",children:[s(K,{...a,isAdmin:!0}),s(T,{label:"Offset",value:n,type:"number",onChange:({target:{value:i}})=>l(parseInt(i)),onKeyDown:({key:i})=>{i==="Enter"&&r(n)}}),s(b,{onClick:t,children:"Refuel"})]})};var x=(e=>(e[e.NewPhrase=0]="NewPhrase",e[e.ChangeStart=1]="ChangeStart",e[e.ChangeEnd=2]="ChangeEnd",e[e.ChangeAspect=3]="ChangeAspect",e[e.DeletePhrase=4]="DeletePhrase",e[e.Verify=5]="Verify",e[e.ChangeSentenceAnnotaion=6]="ChangeSentenceAnnotaion",e))(x||{});const w={start:0,startHelperText:"Start Offset (inclusive)",end:0,endHelperText:"End Offset (exclusive)",hasErrorOccurred:!1,aspect:0},A=(e,r,t)=>{const a=r>=t;let{startHelperText:n,endHelperText:l}=w;return a&&(n=l="start must be less than end"),{...e,start:r,end:t,hasErrorOccurred:a,startHelperText:n,endHelperText:l}},E=(e,r)=>{switch(r.type){case 0:return{...e,aspects_anno:[...e.aspects_anno,w]};case 1:{const{index:t,start:a}=r.payload,n=[...e.aspects_anno],l=n[t],i=A(l,a,l.end);return n[t]=i,{...e,aspects_anno:n}}case 2:{const{index:t,end:a}=r.payload,n=[...e.aspects_anno],l=n[t],i=A(l,l.start,a);return n[t]=i,{...e,aspects_anno:n}}case 3:{const{index:t,aspect:a}=r.payload,n=[...e.aspects_anno],l=n[t];return n[t]={...l,aspect:a},{...e,aspects_anno:n}}case 4:{const{index:t}=r.payload,a=[...e.aspects_anno];return a.splice(t,1),{...e,aspects_anno:a}}case 5:return{...e,isVerified:!0};case 6:return{...e,[r.payload.column]:r.payload.value};default:return e}},ee=({tweetId:e,getChangedColumns:r,disabled:t})=>{const[a,n]=h.exports.useState({display:!1,message:"",intent:"success"}),l=()=>n(f=>({...f,display:!1})),i=async()=>{try{return await M.tweetsUpdateTweet(e,r()),n({display:!0,message:"Successfully Modified",intent:"success"})}catch{return n({display:!1,message:"Modification Failed",intent:"error"})}};return u(k,{children:[s(I,{open:a.display,autoHideDuration:3e3,onClose:l,children:s(R,{onClose:l,severity:a.intent,sx:{width:"100%"},children:a.message})}),s(b,{variant:"contained",onClick:i,disabled:t,children:"Modify"})]})},te=({index:e,end:r,start:t,hasErrorOccurred:a,dispatch:n,startHelperText:l,textLength:i,endHelperText:f,aspect:d,isDisabled:g})=>u("div",{className:"flex items-start justify-between",children:[s(T,{inputProps:{min:0,max:r-1<0?0:r-1},type:"number",value:t,error:a,onChange:({target:{value:o}})=>n({type:x.ChangeStart,payload:{index:e,start:parseInt(o)||0}}),helperText:l}),s(T,{inputProps:{min:t+1,max:i},type:"number",value:r,error:a,onChange:({target:{value:o}})=>n({type:x.ChangeEnd,payload:{index:e,end:parseInt(o)||0}}),helperText:f}),s(H,{value:d,label:"Aspect",onChange:({target:{value:o}})=>n({type:x.ChangeAspect,payload:{index:e,aspect:o}}),children:$.map(O).map((o,p)=>s(j,{value:p,children:o},p))}),s(b,{variant:"contained",color:"warning",onClick:()=>n({type:x.DeletePhrase,payload:{index:e}}),disabled:g,sx:{marginTop:"0.5rem"},children:"Delete Annotation"})]}),se=e=>{const{aspects_anno:r,...t}=e,{dispatch:a,isDisabled:n}=t;return u("div",{className:"items-start mt-0.5",children:[s("div",{className:"flex flex-col",children:r.map((l,i)=>h.exports.createElement(te,{...t,...l,index:i,key:i}))}),s(b,{variant:"contained",color:"secondary",onClick:()=>a({type:x.NewPhrase}),disabled:n,children:"Add New Phrase Annotation"})]})},V=([e,r,t],[a,n,l])=>e-a||r-n||t-l,ne=({row:e,action:r})=>{var g;const[t,a]=h.exports.useReducer(E,{...e,isVerified:!1,aspects_anno:((g=e.aspects_anno)==null?void 0:g.map(([o,p,c])=>({...w,start:o,end:p,aspect:c})))||[]}),n=(o,p)=>a({type:x.ChangeSentenceAnnotaion,payload:{value:o,column:p}}),l=()=>{const o={};e.is_abuse!==t.is_abuse&&(o.is_abuse=t.is_abuse),e.sexual_score!==t.sexual_score&&(o.sexual_score=t.sexual_score);const p=t.aspects_anno.map(({start:m,end:_,aspect:v})=>[m,_,v]).sort(V),c=[...e.aspects_anno||[]].sort(V);return G(p,c)||(o.aspects_anno=p),o},i=h.exports.useMemo(()=>t.aspects_anno.every(({hasErrorOccurred:o})=>!o),[t.aspects_anno]),f=h.exports.useMemo(()=>t.aspects_anno.map(({start:o,end:p})=>({startIndex:o,numChars:p-o})),[t.aspects_anno]),d=()=>{i?D.pseudoTweetsVerifyPseudoTweet(t.id,l()).then(()=>a({type:x.Verify})):console.error("Error in phrase annotaion")};return u(N,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[s(C,{sx:{fontSize:"1rem",paddingTop:"0px"},align:"left",children:u("div",{className:"flex flex-col",children:[s(q.InteractiveHighlighter,{text:t.text,highlights:f,customClass:"highlighted"}),s(se,{aspects_anno:t.aspects_anno,dispatch:a,isDisabled:r==="verify"&&t.isVerified,textLength:t.text.length})]})}),s(C,{align:"center",children:s(F,{checked:t.is_abuse,onChange:({target:{checked:o}})=>n(o,"is_abuse")})}),s(C,{align:"center",children:s(T,{inputProps:{min:1,max:10},type:"number",value:t.sexual_score,onChange:({target:{value:o}})=>n(parseInt(o)||1,"sexual_score"),helperText:"1-10"})}),s(C,{align:"right",children:r==="modify"?s(ee,{tweetId:t.id,getChangedColumns:l,disabled:!i}):s(k,{children:t.isVerified?s(b,{color:"success",disabled:r==="verify"||!i,onClick:d,children:"Verified"}):s(b,{variant:"contained",onClick:d,disabled:!i,children:"Verify"})})})]})},ue=({action:e})=>{const[r,t]=h.exports.useState([]),[a,n]=h.exports.useState(0),[l,i]=h.exports.useState(!1),f=J(),{topics:d,sources:g}=f,o=e==="verify";return h.exports.useEffect(()=>{let c,m;if(d.length===P.length+1||d.length===0)c=void 0,m=[];else{const y=d.indexOf(-1);y<0?(c=void 0,m=d.length===P.length?[]:d):(c=!0,m=[...d.slice(0,y),...d.slice(y+1,d.length)])}const _=g.length===Q.length?[]:g,S=(o?D.pseudoTweetsReadPseudoTweets:M.tweetsReadTweets)(c,_,m,a,10);return S.then(y=>t(y)).catch(y=>{y instanceof X&&console.log("TweetCollectionAdminPanel umounted")}),()=>{S==null||S.cancel()}},[a,l,d,g]),u("div",{className:"w-11/12 mx-auto",children:[s("h1",{className:"my-5 text-xl font-bold text-cyan-700 text-center",children:o?"Verify Model's Predictions":"Modify Verifications"}),s(Z,{offset:a,setOffset:n,toggleReload:()=>i(!l),combinedProps:f}),r.length>0?s(B,{component:L,sx:{height:500},children:u(U,{stickyHeader:!0,sx:{minWidth:650,borderSpacing:"0 20px"},"aria-label":"simple table",children:[u("colgroup",{children:[s("col",{width:"70%"}),s("col",{width:"10%"}),s("col",{width:"10%"}),s("col",{width:"10%"})]}),s(W,{children:s(N,{children:["Text",...Y.map(({field:c})=>c)].map(O).map((c,m)=>s(C,{align:"center",sx:{width:50,fontWeight:"bold"},children:c},m))})}),s(z,{children:r.map(c=>s(ne,{row:c,action:e},c.id))})]})}):s("p",{className:"flex justify-center h-96 items-center",children:s("b",{children:"No texts to show"})})]})};export{ue as default};
