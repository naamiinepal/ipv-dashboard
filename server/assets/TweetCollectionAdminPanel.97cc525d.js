import{r as f,c as h}from"./react.4f0cd3ad.js";import{a as P,P as M,C as D}from"./client.035c4e8e.js";import{A as R,t as H,n as V,s as U}from"./index.abc30d3a.js";import{a as g,j as l,F as x}from"./react_router.1cf934e0.js";import{N as S,q as m,S as L,Q as B,R as k,U as E,V as A,W as y,X as W,Y as q,r as G,Z as $,$ as z,a0 as K}from"./mui_material.a755af34.js";import"./mui_extras.b976686b.js";import"./chart_js.170025e6.js";import"./chart_js_extras.81c15501.js";const Q=({offset:n,setOffset:s,toggleReload:t})=>{const[e,r]=f.exports.useState(n);return g("div",{className:"w-5/12 flex items-end mb-3",children:[l(S,{label:"Offset",value:e,type:"number",onChange:({target:{value:a}})=>r(parseInt(a)),onKeyDown:({key:a})=>{a==="Enter"&&s(e)}}),l(m,{onClick:t,children:"Refuel"})]})};var _=(n=>(n[n.NewPhrase=0]="NewPhrase",n[n.ChangeStart=1]="ChangeStart",n[n.ChangeEnd=2]="ChangeEnd",n[n.ChangeAspect=3]="ChangeAspect",n[n.DeletePhrase=4]="DeletePhrase",n[n.Verify=5]="Verify",n[n.ChangeSentenceAnnotaion=6]="ChangeSentenceAnnotaion",n))(_||{});const w={start:0,startHelperText:"Start Offset (inclusive)",end:0,endHelperText:"End Offset (exclusive)",hasErrorOccurred:!1,aspect:0},O=(n,s,t)=>{const e=s>=t;let{startHelperText:r,endHelperText:a}=w;return e&&(r=a="start must be less than end"),{...n,start:s,end:t,hasErrorOccurred:e,startHelperText:r,endHelperText:a}},X=(n,s)=>{switch(s.type){case 0:return{...n,aspects_anno:[...n.aspects_anno,w]};case 1:{const{index:t,start:e}=s.payload,r=[...n.aspects_anno],a=r[t],i=O(a,e,a.end);return r[t]=i,{...n,aspects_anno:r}}case 2:{const{index:t,end:e}=s.payload,r=[...n.aspects_anno],a=r[t],i=O(a,a.start,e);return r[t]=i,{...n,aspects_anno:r}}case 3:{const{index:t,aspect:e}=s.payload,r=[...n.aspects_anno],a=r[t];return r[t]={...a,aspect:e},{...n,aspects_anno:r}}case 4:{const{index:t}=s.payload,e=[...n.aspects_anno];return e.splice(t,1),{...n,aspects_anno:e}}case 5:return{...n,isVerified:!0};case 6:return{...n,[s.payload.column]:s.payload.value};default:return n}},Y=({tweetId:n,getChangedColumns:s,disabled:t})=>{const[e,r]=f.exports.useState({display:!1,message:"",intent:"success"}),a=()=>r(p=>({...p,display:!1})),i=async()=>{try{return await P.tweetsUpdateTweet(n,s()),r({display:!0,message:"Successfully Modified",intent:"success"})}catch{return r({display:!1,message:"Modification Failed",intent:"error"})}};return g(x,{children:[l(L,{open:e.display,autoHideDuration:3e3,onClose:a,children:l(B,{onClose:a,severity:e.intent,sx:{width:"100%"},children:e.message})}),l(m,{variant:"contained",onClick:i,disabled:t,children:"Modify"})]})},Z=({index:n,end:s,start:t,hasErrorOccurred:e,dispatch:r,startHelperText:a,textLength:i,endHelperText:p,aspect:c,isDisabled:u})=>g(x,{children:[l(S,{inputProps:{min:0,max:s-1<0?0:s-1},type:"number",value:t,error:e,onChange:({target:{value:o}})=>r({type:_.ChangeStart,payload:{index:n,start:parseInt(o)||0}}),helperText:a}),l(S,{inputProps:{min:t+1,max:i},type:"number",value:s,error:e,onChange:({target:{value:o}})=>r({type:_.ChangeEnd,payload:{index:n,end:parseInt(o)||0}}),helperText:p}),l(k,{value:c,label:"Aspect",onChange:({target:{value:o}})=>r({type:_.ChangeAspect,payload:{index:n,aspect:o}}),children:R.map(H).map((o,d)=>l(E,{value:d,children:o},d))}),l(m,{variant:"contained",color:"warning",onClick:()=>r({type:_.DeletePhrase,payload:{index:n}}),disabled:u,children:"Delete Annotation"})]}),J=n=>{const{aspects_anno:s,...t}=n,{dispatch:e,isDisabled:r}=t;return g(x,{children:[s.map((a,i)=>f.exports.createElement(Z,{...t,...a,index:i,key:i})),l(m,{variant:"contained",color:"secondary",onClick:()=>e({type:_.NewPhrase}),disabled:r,children:"Add New Phrase Annotation"})]})};var F={},C={},ee=h&&h.__extends||function(){var n=function(s,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var a in r)r.hasOwnProperty(a)&&(e[a]=r[a])},n(s,t)};return function(s,t){n(s,t);function e(){this.constructor=s}s.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),te=h&&h.__createBinding||(Object.create?function(n,s,t,e){e===void 0&&(e=t),Object.defineProperty(n,e,{enumerable:!0,get:function(){return s[t]}})}:function(n,s,t,e){e===void 0&&(e=t),n[e]=s[t]}),ne=h&&h.__setModuleDefault||(Object.create?function(n,s){Object.defineProperty(n,"default",{enumerable:!0,value:s})}:function(n,s){n.default=s}),re=h&&h.__importStar||function(n){if(n&&n.__esModule)return n;var s={};if(n!=null)for(var t in n)t!=="default"&&Object.hasOwnProperty.call(n,t)&&te(s,n,t);return ne(s,n),s};Object.defineProperty(C,"__esModule",{value:!0});C.InteractiveHighlighter=void 0;var b=re(f.exports);function se(n,s){if(n===s)return!0;if(n==null||s==null||n.length!==s.length)return!1;for(var t=0;t<n.length;++t)if(n[t]!==s[t])return!1;return!0}var ae=function(n){ee(s,n);function s(t){var e=n.call(this,t)||this;return e.props.getSelectionFn?e._getSelectionMarker=e.props.getSelectionFn:e._getSelectionMarker=e._getSelectionFromDOM,e.onMouseUpHandler=e.onMouseUpHandler.bind(e),e.props.customClassFn?e._customClassFn=e.props.customClassFn:e._customClassFn=function(r){return r.length>0?e.props.customClass||"default":""},e._segments=[],e}return s.prototype._getSelectionFromDOM=function(){var t=window.getSelection();if(!t)return console.error("getSelection() returned null"),null;var e=t.toString(),r=t.anchorNode,a=t.focusNode,i=t.anchorOffset,p=t.focusOffset,c,u=!1;if(r&&a)c=r.compareDocumentPosition(a);else return console.warn("Returning from onMouseUpHandler because anchorNode or focusNode are null"),null;c===r.DOCUMENT_POSITION_FOLLOWING?u=!0:c===0&&(u=p-i>0);var o=u?i:p,d;if(u)if(r.parentNode)d=r.parentNode;else return console.error("Ended up with null anchorNode.parentNode - should be impossible!"),null;else if(a.parentNode)d=a.parentNode;else return console.error("Ended up with null focusNode.parentNode - should be impossible!"),null;if(d.getAttribute("data-segment")){var v=Number(d.getAttribute("data-segment"));o+=this._segments[v].start}return t.removeAllRanges(),{selectionStart:o,selectionLength:e.length}},s.prototype._computeSegments=function(){for(var t=this.props.highlights,e=[],r=0,a=[],i=function(c){var u=t.map(function(o){return c>=Number(o.startIndex)&&c<Number(o.startIndex)+Number(o.numChars)});se(a,u)||(c>0&&(e.push({start:r,end:c-1,highlights:a.map(function(o,d){return o?d:-1}).filter(function(o){return o!==-1})}),r=c),a=u.slice())},p=0;p<this.props.text.length;p++)i(p);return e.length===0?e.push({start:0,end:this.props.text.length,highlights:[]}):e.push({start:r,end:this.props.text.length,highlights:a.map(function(c,u){return c?u:-1}).filter(function(c){return c!==-1})}),e},s.prototype.onMouseUpHandler=function(t){t.preventDefault();var e=this._getSelectionMarker();if(e&&e.selectionLength){var r=this.props.text.substr(e.selectionStart,e.selectionLength);this.props.selectionHandler&&this.props.selectionHandler(r,e.selectionStart,e.selectionLength)}},s.prototype.render=function(){this._segments=this._computeSegments();for(var t=this.props.text,e=[],r=0;r<this._segments.length;r++){var a=this._segments[r].start,i=this._segments[r].end-this._segments[r].start+1;this._segments[r].highlights.length>0?e.push(b.default.createElement("span",{key:"d"+r,"data-segment":r,className:this._customClassFn(this._segments[r].highlights)},t.substr(a,i))):e.push(b.default.createElement("span",{key:"d"+r,"data-segment":r,className:this._customClassFn(this._segments[r].highlights)},t.substr(a,i)))}return b.default.createElement("span",{onMouseUp:this.onMouseUpHandler},e)},s}(b.Component);C.InteractiveHighlighter=ae;(function(n){var s=h&&h.__createBinding||(Object.create?function(e,r,a,i){i===void 0&&(i=a),Object.defineProperty(e,i,{enumerable:!0,get:function(){return r[a]}})}:function(e,r,a,i){i===void 0&&(i=a),e[i]=r[a]}),t=h&&h.__exportStar||function(e,r){for(var a in e)a!=="default"&&!r.hasOwnProperty(a)&&s(r,e,a)};Object.defineProperty(n,"__esModule",{value:!0}),t(C,n)})(F);const T=([n,s,t],[e,r,a])=>n-e||s-r||t-a,oe=({row:n,action:s})=>{var u;const[t,e]=f.exports.useReducer(X,{...n,isVerified:!1,aspects_anno:((u=n.aspects_anno)==null?void 0:u.map(([o,d,v])=>({...w,start:o,end:d,aspect:v})))||[]}),r=(o,d)=>e({type:_.ChangeSentenceAnnotaion,payload:{value:o,column:d}}),a=()=>{const o={};n.is_abuse!==t.is_abuse&&(o.is_abuse=t.is_abuse),n.sexual_score!==t.sexual_score&&(o.sexual_score=t.sexual_score);const d=t.aspects_anno.map(({start:I,end:N,aspect:j})=>[I,N,j]).sort(T),v=[...n.aspects_anno||[]].sort(T);return V(d,v)||(o.aspects_anno=d),o},i=f.exports.useMemo(()=>t.aspects_anno.every(({hasErrorOccurred:o})=>!o),[t.aspects_anno]),p=f.exports.useMemo(()=>t.aspects_anno.map(({start:o,end:d})=>({startIndex:o,numChars:d-o})),[t.aspects_anno]),c=()=>{i?M.pseudoTweetsVerifyPseudoTweet(t.id,a()).then(()=>e({type:_.Verify})):console.error("Error in phrase annotaion")};return g(A,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[g(y,{sx:{fontSize:"1rem",paddingTop:"0px"},align:"left",children:[l(F.InteractiveHighlighter,{text:t.text,highlights:p,customClass:"highlighted"}),l(J,{aspects_anno:t.aspects_anno,dispatch:e,isDisabled:s==="verify"&&t.isVerified,textLength:t.text.length})]}),l(y,{align:"center",children:l(W,{checked:t.is_abuse,onChange:({target:{checked:o}})=>{r(o,"is_abuse")}})}),l(y,{align:"center",children:l(S,{inputProps:{min:1,max:10},type:"number",value:t.sexual_score,onChange:({target:{value:o}})=>r(parseInt(o)||1,"sexual_score"),helperText:"1-10"})}),l(y,{align:"right",children:s==="modify"?l(Y,{tweetId:t.id,getChangedColumns:a,disabled:!i}):l(x,{children:t.isVerified?l(m,{color:"success",disabled:s==="verify"||!i,onClick:c,children:"Verified"}):l(m,{variant:"contained",onClick:c,disabled:!i,children:"Verify"})})})]})},ge=({action:n})=>{const[s,t]=f.exports.useState([]),[e,r]=f.exports.useState(0),[a,i]=f.exports.useState(!1);return f.exports.useEffect(()=>{const u=(n==="verify"?M.pseudoTweetsReadPseudoTweets:P.tweetsReadTweets)(e,10);return u.then(o=>t(o)).catch(o=>{o instanceof D&&console.log("TweetCollectionAdminPanel umounted")}),()=>{u==null||u.cancel()}},[e,a]),g("div",{className:"mt-10 w-11/12 mx-auto ",children:[l(Q,{offset:e,setOffset:r,toggleReload:()=>i(!a)}),l(q,{component:G,sx:{height:500},children:g($,{stickyHeader:!0,sx:{minWidth:650,borderSpacing:"0 20px"},"aria-label":"simple table",children:[g("colgroup",{children:[l("col",{width:"70%"}),l("col",{width:"10%"}),l("col",{width:"10%"}),l("col",{width:"10%"})]}),l(z,{children:l(A,{children:["Text",...U.map(({field:c})=>c)].map(H).map((c,u)=>l(y,{align:"center",sx:{width:50,fontWeight:"bold"},children:c},u))})}),l(K,{children:s.map(c=>l(oe,{row:c,action:n},c.id))})]})})]})};export{ge as default};
