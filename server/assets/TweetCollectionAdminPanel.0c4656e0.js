import{r as f,c as h}from"./react.4f0cd3ad.js";import{a as P,P as M,C as D}from"./client.d287e005.js";import{t as H,n as R,p as V}from"./index.e8db78b1.js";import{a as g,j as i,F as C}from"./react_router.1cf934e0.js";import{N as S,q as v,S as U,Q as L,R as B,U as k,V as F,W as y,X as E,Y as W,r as q,Z as G,$,a0 as z}from"./mui_material.a755af34.js";import"./mui_extras.1600e50c.js";import"./chart_js.170025e6.js";import"./chart_js_extras.81c15501.js";const K=({offset:n,setOffset:s,toggleReload:t})=>{const[e,r]=f.exports.useState(n);return g("div",{className:"w-5/12 flex items-end mb-3",children:[i(S,{label:"Offset",value:e,type:"number",onChange:({target:{value:a}})=>r(parseInt(a)),onKeyDown:({key:a})=>{a==="Enter"&&s(e)}}),i(v,{onClick:t,children:"Refuel"})]})};var m=(n=>(n[n.NewPhrase=0]="NewPhrase",n[n.ChangeStart=1]="ChangeStart",n[n.ChangeEnd=2]="ChangeEnd",n[n.ChangeAspect=3]="ChangeAspect",n[n.DeletePhrase=4]="DeletePhrase",n[n.Verify=5]="Verify",n[n.ChangeSentenceAnnotaion=6]="ChangeSentenceAnnotaion",n))(m||{});const Q=["others","profanity","physical_threat","rape_threat","general_threat","ethnic_violence","religion_violence","religion_racism","sexism","character_assasination"],w={start:0,startHelperText:"Start Offset (inclusive)",end:0,endHelperText:"End Offset (exclusive)",hasErrorOccurred:!1,aspect:0},O=(n,s,t)=>{const e=s>=t;let{startHelperText:r,endHelperText:a}=w;return e&&(r=a="start must be less than end"),{...n,start:s,end:t,hasErrorOccurred:e,startHelperText:r,endHelperText:a}},X=(n,s)=>{switch(s.type){case 0:return{...n,aspects_anno:[...n.aspects_anno,w]};case 1:{const{index:t,start:e}=s.payload,r=[...n.aspects_anno],a=r[t],l=O(a,e,a.end);return r[t]=l,{...n,aspects_anno:r}}case 2:{const{index:t,end:e}=s.payload,r=[...n.aspects_anno],a=r[t],l=O(a,a.start,e);return r[t]=l,{...n,aspects_anno:r}}case 3:{const{index:t,aspect:e}=s.payload,r=[...n.aspects_anno],a=r[t];return r[t]={...a,aspect:e},{...n,aspects_anno:r}}case 4:{const{index:t}=s.payload,e=[...n.aspects_anno];return e.splice(t,1),{...n,aspects_anno:e}}case 5:return{...n,isVerified:!0};case 6:return{...n,[s.payload.column]:s.payload.value};default:return n}},Y=({tweetId:n,getChangedColumns:s,disabled:t})=>{const[e,r]=f.exports.useState({display:!1,message:"",intent:"success"}),a=()=>r(d=>({...d,display:!1})),l=async()=>{try{return await P.tweetsUpdateTweet(n,s()),r({display:!0,message:"Successfully Modified",intent:"success"})}catch{return r({display:!1,message:"Modification Failed",intent:"error"})}};return g(C,{children:[i(U,{open:e.display,autoHideDuration:3e3,onClose:a,children:i(L,{onClose:a,severity:e.intent,sx:{width:"100%"},children:e.message})}),i(v,{variant:"contained",onClick:l,disabled:t,children:"Modify"})]})},Z=({aspects_anno:n,dispatch:s,isDisabled:t,textLength:e})=>g(C,{children:[n.map(({start:r,hasErrorOccurred:a,startHelperText:l,end:d,endHelperText:c,aspect:p},o)=>g("div",{children:[i(S,{inputProps:{min:0,max:d-1<0?0:d-1},type:"number",value:r,error:a,onChange:({target:{value:u}})=>s({type:m.ChangeStart,payload:{index:o,start:parseInt(u)||0}}),helperText:l}),i(S,{inputProps:{min:r+1,max:e},type:"number",value:d,error:a,onChange:({target:{value:u}})=>s({type:m.ChangeEnd,payload:{index:o,end:parseInt(u)||0}}),helperText:c}),i(B,{value:p,label:"Aspect",onChange:({target:{value:u}})=>s({type:m.ChangeAspect,payload:{index:o,aspect:u}}),children:Q.map(H).map((u,_)=>i(k,{value:_,children:u},_))}),i(v,{variant:"contained",color:"warning",onClick:()=>s({type:m.DeletePhrase,payload:{index:o}}),disabled:t,children:"Delete Annotation"})]},o)),i(v,{variant:"contained",color:"secondary",onClick:()=>s({type:m.NewPhrase}),disabled:t,children:"Add New Phrase Annotation"})]});var I={},x={},J=h&&h.__extends||function(){var n=function(s,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var a in r)r.hasOwnProperty(a)&&(e[a]=r[a])},n(s,t)};return function(s,t){n(s,t);function e(){this.constructor=s}s.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),ee=h&&h.__createBinding||(Object.create?function(n,s,t,e){e===void 0&&(e=t),Object.defineProperty(n,e,{enumerable:!0,get:function(){return s[t]}})}:function(n,s,t,e){e===void 0&&(e=t),n[e]=s[t]}),te=h&&h.__setModuleDefault||(Object.create?function(n,s){Object.defineProperty(n,"default",{enumerable:!0,value:s})}:function(n,s){n.default=s}),ne=h&&h.__importStar||function(n){if(n&&n.__esModule)return n;var s={};if(n!=null)for(var t in n)t!=="default"&&Object.hasOwnProperty.call(n,t)&&ee(s,n,t);return te(s,n),s};Object.defineProperty(x,"__esModule",{value:!0});x.InteractiveHighlighter=void 0;var b=ne(f.exports);function re(n,s){if(n===s)return!0;if(n==null||s==null||n.length!==s.length)return!1;for(var t=0;t<n.length;++t)if(n[t]!==s[t])return!1;return!0}var se=function(n){J(s,n);function s(t){var e=n.call(this,t)||this;return e.props.getSelectionFn?e._getSelectionMarker=e.props.getSelectionFn:e._getSelectionMarker=e._getSelectionFromDOM,e.onMouseUpHandler=e.onMouseUpHandler.bind(e),e.props.customClassFn?e._customClassFn=e.props.customClassFn:e._customClassFn=function(r){return r.length>0?e.props.customClass||"default":""},e._segments=[],e}return s.prototype._getSelectionFromDOM=function(){var t=window.getSelection();if(!t)return console.error("getSelection() returned null"),null;var e=t.toString(),r=t.anchorNode,a=t.focusNode,l=t.anchorOffset,d=t.focusOffset,c,p=!1;if(r&&a)c=r.compareDocumentPosition(a);else return console.warn("Returning from onMouseUpHandler because anchorNode or focusNode are null"),null;c===r.DOCUMENT_POSITION_FOLLOWING?p=!0:c===0&&(p=d-l>0);var o=p?l:d,u;if(p)if(r.parentNode)u=r.parentNode;else return console.error("Ended up with null anchorNode.parentNode - should be impossible!"),null;else if(a.parentNode)u=a.parentNode;else return console.error("Ended up with null focusNode.parentNode - should be impossible!"),null;if(u.getAttribute("data-segment")){var _=Number(u.getAttribute("data-segment"));o+=this._segments[_].start}return t.removeAllRanges(),{selectionStart:o,selectionLength:e.length}},s.prototype._computeSegments=function(){for(var t=this.props.highlights,e=[],r=0,a=[],l=function(c){var p=t.map(function(o){return c>=Number(o.startIndex)&&c<Number(o.startIndex)+Number(o.numChars)});re(a,p)||(c>0&&(e.push({start:r,end:c-1,highlights:a.map(function(o,u){return o?u:-1}).filter(function(o){return o!==-1})}),r=c),a=p.slice())},d=0;d<this.props.text.length;d++)l(d);return e.length===0?e.push({start:0,end:this.props.text.length,highlights:[]}):e.push({start:r,end:this.props.text.length,highlights:a.map(function(c,p){return c?p:-1}).filter(function(c){return c!==-1})}),e},s.prototype.onMouseUpHandler=function(t){t.preventDefault();var e=this._getSelectionMarker();if(e&&e.selectionLength){var r=this.props.text.substr(e.selectionStart,e.selectionLength);this.props.selectionHandler&&this.props.selectionHandler(r,e.selectionStart,e.selectionLength)}},s.prototype.render=function(){this._segments=this._computeSegments();for(var t=this.props.text,e=[],r=0;r<this._segments.length;r++){var a=this._segments[r].start,l=this._segments[r].end-this._segments[r].start+1;this._segments[r].highlights.length>0?e.push(b.default.createElement("span",{key:"d"+r,"data-segment":r,className:this._customClassFn(this._segments[r].highlights)},t.substr(a,l))):e.push(b.default.createElement("span",{key:"d"+r,"data-segment":r,className:this._customClassFn(this._segments[r].highlights)},t.substr(a,l)))}return b.default.createElement("span",{onMouseUp:this.onMouseUpHandler},e)},s}(b.Component);x.InteractiveHighlighter=se;(function(n){var s=h&&h.__createBinding||(Object.create?function(e,r,a,l){l===void 0&&(l=a),Object.defineProperty(e,l,{enumerable:!0,get:function(){return r[a]}})}:function(e,r,a,l){l===void 0&&(l=a),e[l]=r[a]}),t=h&&h.__exportStar||function(e,r){for(var a in e)a!=="default"&&!r.hasOwnProperty(a)&&s(r,e,a)};Object.defineProperty(n,"__esModule",{value:!0}),t(x,n)})(I);const T=([n,s,t],[e,r,a])=>n-e||s-r||t-a,ae=({row:n,action:s})=>{var p;const[t,e]=f.exports.useReducer(X,{...n,isVerified:!1,aspects_anno:((p=n.aspects_anno)==null?void 0:p.map(([o,u,_])=>({...w,start:o,end:u,aspect:_})))||[]}),r=(o,u)=>e({type:m.ChangeSentenceAnnotaion,payload:{value:o,column:u}}),a=()=>{const o={};n.is_abuse!==t.is_abuse&&(o.is_abuse=t.is_abuse),n.sexual_score!==t.sexual_score&&(o.sexual_score=t.sexual_score);const u=t.aspects_anno.map(({start:N,end:A,aspect:j})=>[N,A,j]).sort(T),_=[...n.aspects_anno||[]].sort(T);return R(u,_)||(o.aspects_anno=u),o},l=f.exports.useMemo(()=>t.aspects_anno.every(({hasErrorOccurred:o})=>!o),[t.aspects_anno]),d=f.exports.useMemo(()=>t.aspects_anno.map(({start:o,end:u})=>({startIndex:o,numChars:u-o})),[t.aspects_anno]),c=()=>{l?M.pseudoTweetsVerifyPseudoTweet(t.id,a()).then(()=>e({type:m.Verify})):console.error("Error in phrase annotaion")};return g(F,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[g(y,{sx:{fontSize:"1rem",paddingTop:"0px"},align:"left",children:[i(I.InteractiveHighlighter,{text:t.text,highlights:d,customClass:"highlighted"}),i(Z,{aspects_anno:t.aspects_anno,dispatch:e,isDisabled:s==="verify"&&t.isVerified,textLength:t.text.length})]}),i(y,{align:"center",children:i(E,{checked:t.is_abuse,onChange:({target:{checked:o}})=>{r(o,"is_abuse")}})}),i(y,{align:"center",children:i(S,{inputProps:{min:1,max:10},type:"number",value:t.sexual_score,onChange:({target:{value:o}})=>r(parseInt(o)||1,"sexual_score"),helperText:"1-10"})}),i(y,{align:"right",children:s==="modify"?i(Y,{tweetId:t.id,getChangedColumns:a,disabled:!l}):i(C,{children:t.isVerified?i(v,{color:"success",disabled:s==="verify"||!l,onClick:c,children:"Verified"}):i(v,{variant:"contained",onClick:c,disabled:!l,children:"Verify"})})})]})},fe=({action:n})=>{const[s,t]=f.exports.useState([]),[e,r]=f.exports.useState(0),[a,l]=f.exports.useState(!1);return f.exports.useEffect(()=>{const p=(n==="verify"?M.pseudoTweetsReadPseudoTweets:P.tweetsReadTweets)(e,10);return p.then(o=>t(o)).catch(o=>{o instanceof D&&console.log("TweetCollectionAdminPanel umounted")}),()=>{p==null||p.cancel()}},[e,a]),g("div",{className:"mt-10 w-11/12 mx-auto ",children:[i(K,{offset:e,setOffset:r,toggleReload:()=>l(!a)}),i(W,{component:q,sx:{height:500},children:g(G,{stickyHeader:!0,sx:{minWidth:650,borderSpacing:"0 20px"},"aria-label":"simple table",children:[g("colgroup",{children:[i("col",{width:"70%"}),i("col",{width:"10%"}),i("col",{width:"10%"}),i("col",{width:"10%"})]}),i($,{children:i(F,{children:["Text",...V.map(({field:c})=>c)].map(H).map((c,p)=>i(y,{align:"center",sx:{width:50,fontWeight:"bold"},children:c},p))})}),i(z,{children:s.map(c=>i(ae,{row:c,action:n},c.id))})]})})]})};export{fe as default};
